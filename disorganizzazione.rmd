# SBM
## Preliminary steps

We start by making an undirected version of our graph to work with. 

```{r message=FALSE, warning=FALSE}
neurons_g_undirected <- as.undirected(neurons_g, mode="collapse" )
Y_undirected = as_adjacency_matrix(neurons_g_undirected, sparse = F)
```

```{r eval=FALSE, include=FALSE}
plotMyMatrix(Y_undirected, dimLabels = list(row = 'neurons', col = 'neurons'))
```
![adjacency]("Plots/SBM/adjacency.jpg")

## Bernoulli
```{r}
sbm1 = estimateSimpleSBM(Y_undirected, "bernoulli", dimLabels = 'neurons', 
                         estimOptions = list(verbosity = 1))
```
```{r}
sbm1
sbm1$nbBlocks; sbm1$blockProp; round(sbm1$connectParam$mean,3)
plot(sbm1, type = "data") ## stessa matrice di adiacenza vista prima, perÃ² shifta righe e colonne per mettere vicini nodi dello stesso gruppo
# nodes are ordered wrt to the block they belong to and blocks are highlighted
plot(sbm1, type = "expected")
# fitted connection probabilities
plot(sbm1, type = "meso")
# fitted connection probabilities 

# info on all estimated model is given in 
sbm1$storedModels

sbm1$memberships

plot(neurons_g_undirected, vertex.color = sbm1$memberships)
```

## Poisson
```{r}
sbm2 = estimateSimpleSBM(Y_undirected, "poisson", dimLabels = 'neurons', 
                         estimOptions = list(verbosity = 1))

sbm2



# selected number of blocks
sbm2$nbBlocks
# prior block probabilities
sbm2$blockProp
# connectivity parameters
round(sbm2$connectParam$mean,3)
#diag principale prob di osservare link intragruppo, outofdiag sono le prob di oss link tra membri di quei gruppi


# Let us graphically represent the data matrix 
# reordering rows and cols according to the estimated block in the SBM

plot(sbm2, type = "data", dimLabels = list(row = 'neurons', col= 'neurons'))

# or the average number of connections between neuronss
plot(sbm2, type = "expected", dimLabels = list(row = 'neurons', col= 'neurons'))

# or 
plot(sbm2, type = "meso", dimLabels = list(row = 'neurons', col= 'neurons'))

```

